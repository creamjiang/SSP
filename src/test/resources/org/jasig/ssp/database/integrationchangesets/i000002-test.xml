<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
				   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<property name="nvarchar.type" value="character varying" dbms="postgresql" />
	<property name="nvarchar.type" value="nvarchar" dbms="mssql" />
	<property name="check_for_manage_integration_database_config_sql"
			  value="select count(id) from config where name='manage_integration_database'" />
	<property name="should_manage_integration_database_sql"
			  value="select case lower(value) when 'true' then 'true' else 'false' end as value from config where name='manage_integration_database'" />

	<changeSet id="Update external_term to avoid gaps" author="dan.mccallum">
		<preConditions onFail="CONTINUE"
					   onFailMessage="Skip updating the external_term table for integration database">
			<sqlCheck expectedResult="1">${check_for_manage_integration_database_config_sql}
			</sqlCheck>
			<sqlCheck expectedResult="true">${should_manage_integration_database_sql}
			</sqlCheck>
		</preConditions>
		<update tableName="external_term">
			<column name="end_date" value="2012-12-31T23:59:59" />
			<where>code='FA12'</where>
		</update>
		<update tableName="external_term">
			<column name="start_date" value="2013-01-01T00:00:00" />
			<column name="end_date" value="2013-12-31T23:59:59" />
			<where>code='SP13'</where>
		</update>
	</changeSet>


</databaseChangeLog>