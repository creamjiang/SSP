<?xml version="1.0" encoding="UTF-8"?>

<!-- Similar to ssp-local, this file allows you greater access to the application's 
	SECURITY configuration on a per site basis. This is a primary point of access 
	for integration into systems like ldap. -->

<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/security
		http://www.springframework.org/schema/security/spring-security-3.0.xsd
		http://www.springframework.org/schema/util		
		http://www.springframework.org/schema/util/spring-util-3.1.xsd">

	<!-- Properties file configuration of existing beans -->
	<beans:bean id="configProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
		<beans:property name="ignoreResourceNotFound" value="true" />
		<beans:property name="locations">
			<beans:list>
				<beans:value>classpath:ssp-config.default.properties</beans:value>
				<beans:value>file:#{T(org.jasig.ssp.config.logging.ExternalConfigLoader).getConfigDir()}/ssp-config.properties</beans:value>
			</beans:list>
		</beans:property>
	</beans:bean>

	<beans:import resource="ssp-sec-dev.xml" />

	<beans:beans profile="uportal">

		<authentication-manager alias="authenticationManager">
			<authentication-provider ref="sspPreAuthenticatedAuthenticationProvider" />
		</authentication-manager>

		<beans:bean id="sspPreAuthenticatedAuthenticationProvider"
			class="org.springframework.security.web.authentication.preauth.PreAuthenticatedAuthenticationProvider">
			<beans:property name="preAuthenticatedUserDetailsService" ref="userDetailsService"/>
		</beans:bean>
		
		<beans:bean id="uPortalPersonAttributesService" class="org.jasig.ssp.service.impl.SpcPersonAttributesService">
            <beans:property name="dataSource" ref="sspDataSource" />
            <beans:property name="sql" value="SELECT oprid FROM s_external_roles WHERE (rolename = :scsRoleName OR rolename = 'S_OSSD_LEVEL_10')" />
            <beans:property name="columnName" value="oprid" />
		</beans:bean>
		
	</beans:beans>

</beans:beans>

